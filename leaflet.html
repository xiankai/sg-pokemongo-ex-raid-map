<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <title>Potential EX-raid locations in Singapore</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src="https://cdn.ravenjs.com/3.20.1/raven.min.js" crossorigin="anonymous"></script>
    <script>
        Raven.config('https://aba13d4b00f2498d8ae696d22a2e0c36@sentry.io/252833', {
            release: '6 Dec'
        }).install()

    </script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-89688850-3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-89688850-3');
    </script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin="" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.2.0/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.2.0/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.2.0/dist/leaflet.markercluster.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            z-index: 0;
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <style>
        select {
            width: 90%;
            margin: 5%;
        }

        .filter-group ul {
            padding-left: 1em;
        }

        .filter-group ul li {
            list-style: none;
        }

        .filter-group ul li::before {
            content: "\2022";
            font-size: 3em;
            padding-right: 0.25em;
            vertical-align: top;
        }

        .filter-group ul li:nth-of-type(1)::before {
            color: black;
        }

        .filter-group ul li:nth-of-type(2)::before {
            color: orange;
        }

        .filter-group ul li:nth-of-type(3)::before {
            color: red;
        }

        .filter-group {
            background-color: #3386c0;
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            font-weight: 600;
            position: absolute;
            top: 10px;
            right: 50px;
            z-index: 1;
            border-radius: 3px;
            width: 130px;
            color: #fff;
        }

        .filter-group input[type=checkbox]:first-child+label {
            border-radius: 3px 3px 0 0;
        }

        .filter-group label:last-child {
            border-radius: 0 0 3px 3px;
            border: none;
        }

        .filter-group input[type=checkbox] {
            display: none;
        }

        .filter-group input[type=checkbox]+label {
            background-color: #3386c0;
            display: block;
            cursor: pointer;
            padding: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.25);
        }

        .filter-group input[type=checkbox]+label {
            background-color: #3386c0;
            text-transform: capitalize;
        }

        .filter-group input[type=checkbox]+label:hover,
        .filter-group input[type=checkbox]:checked+label {
            background-color: #4ea0da;
        }

        .filter-group input[type=checkbox]+label:before {
            content: '✘';
            margin-right: 5px;
        }

        .filter-group input[type=checkbox]:checked+label:before {
            content: '✔';
            margin-right: 5px;
        }
    </style>

    <div id='map'></div>

    <nav id='filter-group' class='filter-group'>
        <ul>
            Legend
            <li>No EX-raid yet</li>
            <li>1 EX-raid</li>
            <li>> 1 EX-raid</li>
        </ul>
    </nav>

    <noscript>
        Oops! This map will not work without javascript, so you need to enable it. It won't hurt, I swear on mewtwo's fingers.
    </noscript>
    <script>
        function fetchLocal(url) {
            return new Promise(function (resolve, reject) {
                var xhr = new XMLHttpRequest
                xhr.onload = function () {
                    resolve(JSON.parse(xhr.responseText))
                }
                xhr.onerror = function () {
                    reject(new TypeError('Local request failed'))
                }
                xhr.open('GET', url)
                xhr.send(null)
            })
        }

        function renderPopup(layer) {
            console.log(layer);
            var feature = layer.feature;
            var count = feature.properties.count;
            var lngLat = feature.geometry.coordinates;

            var exraidHTML = '';
            if (count) {
                exraidHTML += '<div>EX-raids:<ul>';
                feature.properties.dates.forEach(function (date) {
                    exraidHTML += '<li>' + date + '</li>';
                });
            } else {
                exraidHTML += '<div>No EX-raid yet</div>';
            }

            return (
                '<strong>' + feature.properties.name + '</strong>' +
                '<div>' +
                exraidHTML +
                '<a target="_blank" href="https://www.google.com/maps/search/?api=1&query=' + lngLat[1] + ',' + lngLat[0] + '">' +
                'Google Maps' +
                '</a>' +
                '</div>'
            );
        }

        var map = L.map('map').setView([1.358, 103.833], 12);

        fetchLocal('https://cdn.rawgit.com/xiankai/fc4260e305d1339756a3e1a02b495939/raw/3c7e9af509732ffe832f5ea0ed5e322f98726b19/all.geojson')
            .then(data => {
                var markers = L.markerClusterGroup();
                markers.addLayer(
                    L.geoJSON(data)
                ).bindPopup(renderPopup);
                map.addLayer(markers);
            })



        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

        // L.marker([51.5, -0.09]).addTo(map)
        //     .bindPopup('A pretty CSS3 popup.<br> Easily customizable.')
        //     .openPopup();
    </script>

</body>

</html>
